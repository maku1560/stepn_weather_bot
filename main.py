# STEPN Weather Bot v2025-08-10-10
# æ©Ÿèƒ½: ç›´è¿‘3æ™‚é–“ã®å¤©æ°— + çŸ›ç›¾ãªã—ã‚³ãƒ¡ãƒ³ãƒˆ(å¤©æ°—Ã—æ°—æ¸©Ã—æ™‚é–“å¸¯) + å¼·é¢¨è¿½è¨˜
#       æ–¹è¨€ã‚¹ã‚­ãƒ³ï¼ˆä¸­ç«‹â†’æ–¹è¨€åŒ–ï¼‰ + AAé¡”æ–‡å­—ï¼ˆé »åº¦UPï¼‰ + æŸ”ã‚‰ã‹èªå°¾
# å®‰å…¨åŒ–: commentsæ¬ è½æ™‚ã§ã‚‚è½ã¡ãªã„ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã€ã‚¨ãƒ©ãƒ¼æ–‡ã‚‚æ–¹è¨€ï¼†AA

import os
import re
import random
from datetime import datetime, timedelta, timezone

# .envï¼ˆç„¡ãã¦ã‚‚å‹•ãï¼‰
try:
    from dotenv import load_dotenv
    load_dotenv()
except Exception:
    pass

import aiohttp
import discord
from discord import app_commands

# ---- Config ----
BOT_VERSION = "2025-08-10-10"
BOT_TOKEN = os.getenv("DISCORD_BOT_TOKEN")
JST = timezone(timedelta(hours=9))
USER_AGENT = f"STEPN-Weather-Bot/{BOT_VERSION} (contact: your-email@example.com)"

INTENTS = discord.Intents.default()
INTENTS.message_content = True

class WeatherBot(discord.Client):
    def __init__(self):
        super().__init__(intents=INTENTS)
        self.tree = app_commands.CommandTree(self)

    async def setup_hook(self):
        await self.tree.sync()

client = WeatherBot()

# ---------- Geocoding ----------
async def geocode(session: aiohttp.ClientSession, query: str):
    def pick_best(results: list[dict]) -> dict | None:
        if not results:
            return None
        cities = [r for r in results if r.get("admin1") and r.get("country")]
        if cities:
            cities.sort(key=lambda r: (r.get("population") or 0), reverse=True)
            return cities[0]
        return results[0]

    async def search(name: str):
        url = "https://geocoding-api.open-meteo.com/v1/search"
        params = {"name": name, "count": 10, "language": "ja", "format": "json"}
        headers = {"User-Agent": USER_AGENT}
        async with session.get(url, params=params, headers=headers, timeout=15) as resp:
            if resp.status != 200:
                return []
            data = await resp.json()
            return data.get("results", []) or []

    alias = {
        "USJ": "ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ãƒ»ã‚¹ã‚¿ã‚¸ã‚ªãƒ»ã‚¸ãƒ£ãƒ‘ãƒ³",
        "ãƒ¦ãƒ‹ãƒ": "ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ãƒ»ã‚¹ã‚¿ã‚¸ã‚ªãƒ»ã‚¸ãƒ£ãƒ‘ãƒ³",
        "ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼": "æ±äº¬ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼ãƒ©ãƒ³ãƒ‰",
        "ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼ãƒ©ãƒ³ãƒ‰": "æ±äº¬ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼ãƒ©ãƒ³ãƒ‰",
        "ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼ã‚·ãƒ¼": "æ±äº¬ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼ã‚·ãƒ¼",
        "TDL": "æ±äº¬ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼ãƒ©ãƒ³ãƒ‰",
        "TDS": "æ±äº¬ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼ã‚·ãƒ¼",
        "æ¢…ç”°": "å¤§é˜ªå¸‚ æ¢…ç”°",
        "ãªã‚“ã°": "å¤§é˜ªå¸‚ ãªã‚“ã°",
        "å¿ƒæ–æ©‹": "å¤§é˜ªå¸‚ å¿ƒæ–æ©‹",
        "é€šå¤©é–£": "å¤§é˜ªå¸‚ é€šå¤©é–£",
        "å¤©ç‹å¯º": "å¤§é˜ªå¸‚ å¤©ç‹å¯º",
        "ã‚¹ã‚«ã‚¤ãƒ„ãƒªãƒ¼": "æ±äº¬ã‚¹ã‚«ã‚¤ãƒ„ãƒªãƒ¼",
        "æ±äº¬é§…": "æ±äº¬é§…",
        "æµ…è‰": "å°æ±åŒº æµ…è‰",
        "ç§‹è‘‰åŸ": "åƒä»£ç”°åŒº ç§‹è‘‰åŸ",
        "æ¨ªæµœä¸­è¯è¡—": "æ¨ªæµœå¸‚ ä¸­åŒº",
    }
    romaji = {
        "å¤§é˜ª": "Osaka", "äº¬éƒ½": "Kyoto", "æœ­å¹Œ": "Sapporo", "åå¤å±‹": "Nagoya",
        "ç¦å²¡": "Fukuoka", "ç¥æˆ¸": "Kobe", "æ¨ªæµœ": "Yokohama", "ä»™å°": "Sendai",
        "åƒè‘‰": "Chiba", "å·å´": "Kawasaki", "ã•ã„ãŸã¾": "Saitama", "é‚£è¦‡": "Naha",
        "åºƒå³¶": "Hiroshima", "é‡‘æ²¢": "Kanazawa",
    }

    trials = [query]
    if query in alias:
        trials.append(alias[query])
    if not query.endswith(("å¸‚", "åŒº", "ç”º", "æ‘")) and len(query) <= 4:
        trials.append(query + "å¸‚")
    if query in romaji:
        trials.append(romaji[query])

    seen, uniq_trials = set(), []
    for t in trials:
        if t not in seen:
            uniq_trials.append(t); seen.add(t)

    for q in uniq_trials:
        results = await search(q)
        chosen = pick_best(results)
        if chosen:
            return {
                "name": chosen.get("name"),
                "latitude": chosen.get("latitude"),
                "longitude": chosen.get("longitude"),
                "country": chosen.get("country"),
                "admin1": chosen.get("admin1"),
                "timezone": chosen.get("timezone"),
            }
    return None

# ---------- Forecast ----------
async def fetch_forecast(session: aiohttp.ClientSession, lat: float, lon: float, tz: str):
    url = "https://api.open-meteo.com/v1/forecast"
    params = {
        "latitude": lat, "longitude": lon,
        "hourly": (
            "temperature_2m,precipitation_probability,precipitation,weathercode,"
            "windspeed_10m"
        ),
        "timezone": tz or "Asia/Tokyo"
    }
    headers = {"User-Agent": USER_AGENT}
    async with session.get(url, params=params, headers=headers, timeout=15) as resp:
        if resp.status != 200:
            return None
        return await resp.json()

# ---------- Emoji ----------
WEATHER_EMOJI = {
    0:"â˜€ï¸",1:"ğŸŒ¤ï¸",2:"â›…",3:"â˜ï¸",45:"ğŸŒ«ï¸",48:"ğŸŒ«ï¸",
    51:"ğŸŒ¦ï¸",53:"ğŸŒ¦ï¸",55:"ğŸŒ§ï¸",61:"ğŸŒ¦ï¸",63:"ğŸŒ§ï¸",65:"ğŸŒ§ï¸",66:"ğŸŒ§ï¸",67:"ğŸŒ§ï¸",
    71:"ğŸŒ¨ï¸",73:"ğŸŒ¨ï¸",75:"â„ï¸",77:"â„ï¸",80:"ğŸŒ§ï¸",81:"ğŸŒ§ï¸",82:"â›ˆï¸",
    85:"ğŸŒ¨ï¸",86:"ğŸŒ¨ï¸",95:"â›ˆï¸",96:"â›ˆï¸",99:"â›ˆï¸"
}
def pick_emoji(code:int)->str: return WEATHER_EMOJI.get(code,"ğŸŒ¡ï¸")

# ---- åˆ†é¡ï¼ˆå¤©æ°—Ã—æ°—æ¸©Ã—æ™‚é–“å¸¯ï¼‰ ----
def categorize_weather(rows):
    codes = [r["weathercode"] for r in rows]
    if any(c in (95,96,99) for c in codes):
        return "thunder"
    if any(c in (71,73,75,77,85,86) for c in codes):
        return "snow"
    if any(c in (51,53,55,61,63,65,66,67,80,81,82) for c in codes):
        return "rain"
    if all(c in (0,1,2) for c in codes):
        return "clear"
    return "cloudy"

def categorize_temp(rows):
    m = max(r["temp"] for r in rows)
    if m < 10: return "cold"
    if m < 20: return "cool"
    if m < 28: return "warm"
    return "hot"

def categorize_time(rows):
    h = rows[0]["time"].hour
    if 5 <= h <= 9:  return "morning"
    if 10 <= h <= 15: return "noon"
    if 16 <= h <= 18: return "evening"
    return "night"

# ---------- çŸ›ç›¾ãªã—ã‚³ãƒ¡ãƒ³ãƒˆè¾æ›¸ï¼ˆå„3æœ¬ãƒ»ãƒ™ãƒ¼ã‚¹é–¢è¥¿â†’å¾Œã§ä¸­ç«‹åŒ–â†’æ–¹è¨€åŒ–ï¼‰ ----------
comments = {
    "clear": {
        "cold": {
            "morning": [
                "å¿«æ™´ã‚„ã‘ã©æœã¯å†·ãˆã‚‹ã§ã€æ‰‹è¢‹ã‚ã‚‹ã¨å®‰å¿ƒã‚„",
                "ç©ºã¯ã‚­ãƒ¬ã‚¤ã‚„ã®ã«ç©ºæ°—ã¯ã‚­ãƒ³ã¨å†·ãŸã„ãªã€æš–ã‹ãã—ã¦ã„ã“",
                "æ—¥å·®ã—ã¯ã‚ã‚‹ã‘ã©ä½“ã¯å†·ãˆã‚‹ã€é‡ã­ç€ã—ã¨ã“",
            ],
            "noon": [
                "æ™´ã‚Œã‚„ã‘ã©ç©ºæ°—ã¯å†·ãŸã„ã€æ—¥å‘ã‚’é¸ã‚“ã§æ­©ã“",
                "æ—¥å·®ã—ã§ä½“æ„Ÿã¯å°‘ã—ãƒã‚·ã‚„ã€ä¸Šç€ã¯ã¾ã è¦ã‚‹ã§",
                "é¢¨é‚ªã²ã‹ã‚“ã‚ˆã†ã«ã€å¤ªé™½ã®ä¸‹ã§æ¸©ã¾ã£ã¦ã“",
            ],
            "evening": [
                "å¤•æ–¹ã‹ã‚‰ã¾ãŸå†·ãˆæˆ»ã‚‹ã§ã€å¸°ã‚Šã®ä¸€æšã¯å¿˜ã‚Œãšã«ãª",
                "æ—¥æ²¡ã§ä¸€æ°—ã«å¯’ãªã‚‹ã€æ—©ã‚ã«å¸°ã‚",
                "æ”¾å°„å†·å´ã§å†·ãˆã‚„ã™ã„ã€æ²¹æ–­ç¦ç‰©ã‚„",
            ],
            "night": [
                "å¤œã¯æ”¾å°„å†·å´ã§ã‚°ãƒƒã¨å†·ãˆã‚‹ã€åšç€ã—ã¨ãã‚„",
                "æ˜Ÿç©ºã¯ç¶ºéº—ã‚„ã‘ã©å¯’ã„ã§ã€å¯„ã‚Šé“å°‘ãªã‚ã§ãª",
                "å¸°ã‚Šã¯æ‰‹å…ˆã‹ã‚‰å†·ãˆã‚‹ã€ãƒã‚±ãƒƒãƒˆã«ã‚«ã‚¤ãƒ­ä»•è¾¼ã‚“ã©ã“",
            ],
        },
        "cool": {
            "morning": [
                "ã²ã‚“ã‚„ã‚Šæ™´ã‚Œã®æœã‚„ã€è»½ã„ä¸Šç€ã§ã¡ã‚‡ã†ã©ãˆãˆãª",
                "ç©ºæ°—ã‚¹ãƒƒã¨ã—ã¦æ°—æŒã¡ãˆãˆã€æœæ´»ã¯ã‹ã©ã‚‹ã§",
                "é™½ã‚’æµ´ã³ã¦ä½“èµ·ã“ã—ã¦ã„ã“",
            ],
            "noon": [
                "æ™´ã‚Œã¦æ­©ãã‚„ã™ã„ã€å¤–å›ã‚Šã¯ä»ŠãŒãƒãƒ£ãƒ³ã‚¹ã‚„",
                "æ´—æ¿¯ã‚‚ä¹¾ãã‚„ã™ã„ã§ã€ç”¨äº‹ç‰‡ä»˜ã‘ã‚ˆ",
                "æ—¥å‘ã¨æ—¥é™°ã§ä½“æ„Ÿå·®ã‚ã‚‹ã‹ã‚‰ã€æœè£…ã¯èª¿æ•´ã§ãã‚‹ã¨æ¥½ã‚„",
            ],
            "evening": [
                "å¤•æ–¹ã¯å°‘ã—å†·ãˆæˆ»ã‚‹ã§ã€ä¸€æšã‚ã‚‹ã¨å®‰å¿ƒã‚„",
                "è¥¿æ—¥ãŒã¾ã¶ã—ã„æ™‚é–“ã‚„ã€çœ©ã—ã•å¯¾ç­–ã‚‚ã‚ã‚Šã‚„ãª",
                "å¸°ã‚Šé“ã¯é¢¨ãŒå‡ºã‚‹ã‹ã‚‚ã€ãƒãƒ•ãƒ©ãƒ¼è»½ãå·»ã„ã¨ã“",
            ],
            "night": [
                "å¤œã¯ã²ã‚“ã‚„ã‚Šã€å¸°ã‚Šã¯æ—©ã‚ã«åˆ‡ã‚Šä¸Šã’ã‚ˆ",
                "æ˜ŸãŒã‚ˆã†è¦‹ãˆã‚‹å¤œã‚„ã€ã§ã‚‚ä½“ã¯å†·ãˆã‚‹ã§",
                "é™ã‹ãªå¤œã‚„ãªã€è¶³å…ƒã¨è»Šã«ã ã‘æ³¨æ„ã‚„",
            ],
        },
        "warm": {
            "morning": [
                "ã½ã‹ã½ã‹æ™´ã‚Œã€æ°—æŒã¡ã‚ˆãã‚¹ã‚¿ãƒ¼ãƒˆåˆ‡ã‚Œãã†ã‚„",
                "æœã‹ã‚‰å¤–å‡ºã‚‚å¿«é©ã€è»½è£…ã§ã„ã‘ã‚‹ã§",
                "æ—¥å·®ã—æŸ”ã‚‰ã‹ã„ã‚ã€æ•£æ­©ã«ã´ã£ãŸã‚Šã‚„",
            ],
            "noon": [
                "æ˜¼ã¯éã”ã—ã‚„ã™ã„æ™´ã‚Œã€å¤–ã®ç”¨äº‹ã©ã‚“ã©ã‚“ç‰‡ä»˜ã‘ã‚ˆ",
                "æ´—æ¿¯ï¼†å¸ƒå›£å¹²ã—æ—¥å’Œã‚„ã€ãƒãƒ£ãƒ³ã‚¹ã‚„ã§",
                "å…¬åœ’æ—¥å’Œã‚„ãªã€æ—¥é™°ã§ã¼ãƒ¼ã£ã¨ã™ã‚‹ã®ã‚‚ã‚¢ãƒªã‚„",
            ],
            "evening": [
                "å¤•æ–¹ã¯ç©ºãŒãã‚Œã„ã€æ°—æ¸©ã‚‚ç©ã‚„ã‹ã§ãˆãˆæ„Ÿã˜ã‚„",
                "æ—¥æ²¡å‰ã¯æ¶¼ã—ãªã£ã¦å¿«é©ã‚„ã€å¯„ã‚Šé“ã‚‚æ‚ªããªã„ã§",
                "å¤•ç„¼ã‘ç‹™ã„ã§å†™çœŸã‚‚ãˆãˆãª",
            ],
            "night": [
                "å¤œã‚‚ç©ã‚„ã‹ã€è»½ã‚ã®ç¾½ç¹”ã§ååˆ†ã‚„",
                "æ˜Ÿç©ºè¦‹ã«è¡Œãã®ã‚‚ã‚¢ãƒªã‚„ãªã€å¸°ã‚Šé“ã ã‘æ³¨æ„ã‚„ã§",
                "å¿«é©ãªå¤œã‚„ã€ç”¨äº‹ã¯ä»Šã®ã†ã¡ã«ç‰‡ä»˜ã‘ã‚ˆ",
            ],
        },
        "hot": {
            "morning": [
                "æœã‹ã‚‰æš‘ã„ã§ã€æ°´åˆ†ã¡ã‚‡ã„ã¡ã‚‡ã„è£œçµ¦ãª",
                "æ—¥å·®ã—å¼·ã‚ã‚„ã€æ—¥ç„¼ã‘æ­¢ã‚å¿˜ã‚Œã‚“ã¨ã„ã¦",
                "é€šå‹¤ã¯æ—¥é™°ãƒ«ãƒ¼ãƒˆãŒãŠã™ã™ã‚ã‚„",
            ],
            "noon": [
                "ã‚®ãƒ©ã‚®ãƒ©æ™´ã‚Œã€æ—¥é™°ä¼‘æ†©ï¼†æ°´åˆ†ã¯ãƒã‚¹ãƒˆã‚„ã§",
                "ç†±ä¸­ç—‡æ³¨æ„ã€å¸½å­ã‚ã‚‹ã¨æ¥½ã‚„",
                "å†·ãŸã„é£²ã¿ç‰©ã‚’ç›¸æ£’ã«ã„ã“ã‹",
            ],
            "evening": [
                "å¤•æ–¹ã§ã‚‚æš‘ã•æ®‹ã‚‹ã§ã€ç„¡ç†ã›ã‚“ã¨ã‚†ã£ãã‚Šå¸°ã‚",
                "è¥¿æ—¥ã®ç†±ãŒãã¤ã„ã€ã‚µãƒ³ã‚°ãƒ©ã‚¹ã‚ã‚‹ã¨æ¥½ã‚„ãª",
                "æ—¥æ²¡å¾Œã«å°‘ã—ãƒã‚·ã€ç”¨äº‹ã¯ãã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§",
            ],
            "night": [
                "å¤œã‚‚è’¸ã—æš‘ã„ãªã€é¢¨é€šã—ã®ãˆãˆæœã§å¿«é©ã«",
                "å¯è‹¦ã—ã•å¯¾ç­–ã§æ°´åˆ†ï¼†å†·æˆ¿ã†ã¾ãä½¿ãŠ",
                "é…ã„æ™‚é–“ã§ã‚‚æš‘ã„ã€ç„¡ç†ã¯ç¦ç‰©ã‚„ã§",
            ],
        },
    },
    "cloudy": {
        "cold": {
            "morning": [
                "æ›‡ã‚Šã§ä½™è¨ˆã«å¯’ã„ã€åšæ‰‹ã®ä¸Šç€ã§ã„ã“ã‹",
                "æ—¥å·®ã—ãŒãªã„åˆ†ã²ã‚“ã‚„ã‚Šã‚„ã€æ‰‹è¢‹ã‚‚ã‚ã‚Šã‚„ã§",
                "ä½“èµ·ãã«ãã„å†·ãˆã‚„ã€ã‚†ã£ãã‚Šã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—ãª",
            ],
            "noon": [
                "æ›‡ã‚Šç©ºï¼†å†·ãŸã„ç©ºæ°—ã€å±‹å†…ãƒ¡ã‚¤ãƒ³ã§ã‚‚ãˆãˆã‹ã‚‚ãª",
                "æ—¥é™°ã¿ãŸã„ãªä½“æ„Ÿã‚„ã€é¦–å…ƒæ¸©ã‚ã‚‹ã¨æ¥½ã‚„ã§",
                "é¢¨ãŒå‡ºãŸã‚‰ã•ã‚‰ã«å†·ãˆã‚‹ã€ãƒãƒ•ãƒ©ãƒ¼æº–å‚™ã—ã¨ã“",
            ],
            "evening": [
                "å¤•æ–¹ã¯å†·ãˆè¾¼ã‚€ã§ã€å¸°ã‚Šã¯è¶³æ—©ã«ã„ã“",
                "æ›‡å¤©ã§æš—ãªã‚‹ã®æ—©ã„ã€ãƒ©ã‚¤ãƒˆã¨è¶³å…ƒæ³¨æ„ãª",
                "å¯„ã‚Šé“å°‘ãªã‚ã§ä½“æ¸©é€ƒãŒã•ã‚“ã‚ˆã†ã«",
            ],
            "night": [
                "å¤œã¯åº•å†·ãˆã‚„ã€æ¸©ã‹ã„é£²ã¿ã‚‚ã‚“ã§ã»ã£ã“ã‚Šã—ã‚ˆ",
                "æ›‡ã‚Šã‚„ã¨æ˜Ÿã¯è¦‹ãˆã‚“ã‘ã©ã€é˜²å¯’ã¯ã—ã£ã‹ã‚Šãª",
                "å†·ãˆã‚‹å¤œã‚„ã§ã€å¸°å®…ãƒ«ãƒ¼ãƒˆã¯å®‰å…¨ç¬¬ä¸€ã§",
            ],
        },
        "cool": {
            "morning": [
                "ã²ã‚“ã‚„ã‚Šæ›‡ã‚Šã€è»½ã„ç¾½ç¹”ã§å¿«é©ã«å‹•ã‘ã‚‹ã§",
                "é‹å‹•ã«ã¯ã¡ã‚‡ã†ã©ãˆãˆä½“æ„Ÿã‚„ã€ç„¡ç†ãªãã„ã“",
                "æœã¯è¦–ç•Œæš—ã‚ã€æ¨ªæ–­ã¯ä½™è£•è¦‹ã¦ãª",
            ],
            "noon": [
                "æ—¥å·®ã—å¼±ã‚ã§å‹•ãã‚„ã™ã„ã€ç”¨äº‹ã¯ä»Šã®ã†ã¡ã«",
                "éã”ã—ã‚„ã™ã„ä½“æ„Ÿã‚„ã€æ•£æ­©ã‚‚ä½œæ¥­ã‚‚æ—ã‚‹ã‚",
                "æ´—æ¿¯ã¯ä¹¾ãé…ã‚ã€éƒ¨å±‹å¹²ã—ã‚‚è¦–é‡ã‚„ãª",
            ],
            "evening": [
                "å¤•æ–¹ã‹ã‚‰ã¯è‚Œå¯’ããªã‚‹ã€å¸°ã‚Šã®ä¸€æšã¯å¿˜ã‚Œãšã«",
                "æš—ããªã‚‹ã®æ—©ã„ã§ã€åå°„ç´ æã‚ã‚‹ã¨å®‰å¿ƒã‚„",
                "å¯„ã‚Šé“ã—ã™ããšã€å®‰å…¨ã«å¸°ã‚ã‹",
            ],
            "night": [
                "å¤œã¯ã²ã‚“ã‚„ã‚Šã€é¢¨é‚ªã²ã‹ã‚“ã‚ˆã†æ¸©ã‹ãã—ã¦ãª",
                "è¦–ç•ŒãŒæš—ã„åˆ†ã‚†ã£ãã‚Šæ­©ã“",
                "å¸°å®…ã¯è¶³å…ƒæ³¨æ„ã€æ»‘ã‚Šã‚„ã™ã„è·¯é¢ã‚‚ã‚ã‚‹ã§",
            ],
        },
        "warm": {
            "morning": [
                "æ¸©åº¦ã¯ã¡ã‚‡ã†ã©ãˆãˆã€æ›‡ã‚Šã§çœ©ã—ããªã„ã®ãŒåŠ©ã‹ã‚‹ãª",
                "è»½è£…ã§OKã€å‹•ãã‚„ã™ã„æœã‚„ã§",
                "å¤–ã«å‡ºã‚‹æº–å‚™ã¯ã‹ã©ã‚‹æ°—æ¸©ã‚„",
            ],
            "noon": [
                "ä½œæ¥­æ—¥å’Œã‚„ã€å±‹å¤–ã§ã‚‚è² æ‹…å°‘ãªã‚",
                "æ›‡ã‚Šã§ç†±ã“ã‚‚ã‚Šã«ãã„ã€åŠ¹ç‡ã‚ˆãå‹•ã‘ã‚‹ã§",
                "æ´—æ¿¯ã¯å°‘ã—ä¹¾ãé…ã„ã‹ã‚‰ä½™è£•è¦‹ã¨ã“",
            ],
            "evening": [
                "å¤•æ–¹ã¯æ°—æ¸©ã¡ã‚‡ã†ã©ãˆãˆã€å¸°ã‚Šé“ã‚‚å¿«é©ã‚„",
                "æ—¥æ²¡å‰ã«æ¸ˆã¾ã›ãŸã„ç”¨äº‹ã¯ä»Šã‚„ãª",
                "ã¡ã‚‡ã„é¢¨ã‚ã‚Œã°ã•ã‚‰ã«å¿ƒåœ°ãˆãˆã§",
            ],
            "night": [
                "å¤œã‚‚ç©ã‚„ã‹ã€è–„æ‰‹ã®ç¾½ç¹”ã§ååˆ†ã‚„",
                "è¦–ç•Œã¯æš—ã‚ã€è¶³å…ƒã¨è»Šã«ã ã‘æ³¨æ„ã—ã‚ˆ",
                "å¸°ã‚Šã«ã¡ã‚‡ã£ã¨å¯„ã‚Šé“ã‚‚ã‚¢ãƒªã‚„ãª",
            ],
        },
        "hot": {
            "morning": [
                "æœã‹ã‚‰è’¸ã—æš‘ã„ã€ç„¡ç†ã›ã‚“ãƒšãƒ¼ã‚¹ã§ã„ã“",
                "æ›‡ã£ã¦ã¦ã‚‚ç´«å¤–ç·šã¯æ¥ã‚‹ã€å¯¾ç­–ã¯ã—ã¨ã“",
                "æ—¥é™°ã¯å°‘ã—ãƒã‚·ã‚„ã€ãƒ«ãƒ¼ãƒˆå·¥å¤«ã—ã‚ˆ",
            ],
            "noon": [
                "é›²å¤šã‚ã§ã‚‚æš‘ã•ã¯ç¶šãã€æ°´åˆ†ï¼†ä¼‘æ†©ãª",
                "æ¹¿æ°—ã§ä½“åŠ›å‰Šã‚‰ã‚Œã‚‹ã€æ¶¼ã—ã„æ‰€ã§å°ä¼‘æ­¢ã‚„",
                "ã‚¯ãƒ¼ãƒ«ã‚¿ã‚ªãƒ«ã‚ã‚‹ã¨åŠ©ã‹ã‚‹ã§",
            ],
            "evening": [
                "å¤•æ–¹ã‚‚è’¸ã—æš‘ã•æ®‹ã‚‹ã€ç”¨äº‹ã¯åˆ†å‰²ã—ã¦ã„ã“",
                "è¥¿æ—¥å¼±ã„åˆ†ãƒã‚·ã‚„ã‘ã©ã€ä½“åŠ›é…åˆ†ã¯æ³¨æ„ãª",
                "é¢¨é€šã—ã®ãˆãˆé“ã‚’é¸ã¶ã¨æ¥½ã‚„ã§",
            ],
            "night": [
                "å¤œã‚‚ã‚€ã‚ã£ã¨æš‘ã„ã€å¯ã‚‹å‰ã«æ°´åˆ†ã¨å®¤æ¸©èª¿æ•´ã‚„",
                "å¸°å®…å¾Œã¯ã—ã£ã‹ã‚Šã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ã—ã‚ˆ",
                "é…ã„æ™‚é–“ã®å¤–å‡ºã¯çŸ­ã‚ã«ã€ç„¡ç†ã¯ç¦ç‰©ã‚„",
            ],
        },
    },
    "rain": {
        "cold": {
            "morning": [
                "å†·ãŸã„é›¨ã‚„ã€å‚˜ã¨ã‚ã£ãŸã‹è£…å‚™ã§ã„ã“",
                "æ‰‹ãŒã‹ã˜ã‹ã‚€ã§ã€æ‰‹è¢‹ã‚ã‚‹ã¨åŠ©ã‹ã‚‹ã‚",
                "é´ã‚‚é˜²æ°´ãŒå®‰å¿ƒã‚„ã€è¶³å…ƒæ°—ãƒã¤ã‘ã¦ãª",
            ],
            "noon": [
                "æ˜¼ã‚‚å†·ãŸã„é›¨ã€å±‹å†…ãƒ¡ã‚¤ãƒ³ã§å‹•ãã®ãŒè³¢ã„ã§",
                "æ¿¡ã‚Œã‚‹ã¨ä½“æ¸©å¥ªã‚ã‚Œã‚‹ã€ç„¡èŒ¶ã›ã‚“ã¨ã“",
                "åˆç¾½ãŒã‚ã‚‹ã¨å¿«é©åº¦ã ã„ã¶é•ã†ã§",
            ],
            "evening": [
                "å¤•æ–¹ã¯æš—ãã¦è¶³å…ƒå±ãªã„ã€å¯„ã‚Šé“å°‘ãªã‚ã§",
                "ä½“ã‚‚å†·ãˆã¦ãã‚‹æ™‚é–“ã‚„ã€æ—©ã‚ã®æ’¤åæ¨å¥¨ã‚„ã§",
                "æ¨ªæ®´ã‚Šãªã‚‰å‚˜ï¼‹ãƒ•ãƒ¼ãƒ‰ãŒå®‰å¿ƒã‚„",
            ],
            "night": [
                "å¤œã®é›¨ã¯è¦–ç•Œæ‚ªã„ã€å¸°ã‚Šã¯ã‚†ã£ãã‚Šå®‰å…¨ç¬¬ä¸€",
                "å†·ãŸã„é›¨ã‚„ã‹ã‚‰å¸°å®…å¾Œã¯ã—ã£ã‹ã‚Šæ¸©ã‚‚ã‚",
                "è·¯é¢ã™ã¹ã‚Šã‚„ã™ã„ã§ã€æ°—ãƒã¤ã‘ã‚„",
            ],
        },
        "cool": {
            "morning": [
                "ã²ã‚“ã‚„ã‚Šé›¨ã€å‚˜ã¯å¿…é ˆã‚„ã§",
                "é€šå‹¤ã¯æ°´ãŸã¾ã‚Šå›é¿ã§ã„ã“",
                "ãƒ¬ã‚¤ãƒ³ã‚«ãƒãƒ¼ã‚ã‚‹ã¨è·ç‰©ãŒåŠ©ã‹ã‚‹ãª",
            ],
            "noon": [
                "æ˜¼ã‚‚ãƒ‘ãƒ©ã¤ãã‹ã‚‚ã€åˆé–“è¦‹ã¦å‹•ã“ã†ã‹",
                "æ¿¡ã‚ŒãŸã‚‰ä½“å†·ãˆã‚‹ã€ã‚¿ã‚ªãƒ«ä¸€æšã‚ã‚‹ã¨å®‰å¿ƒ",
                "å±‹å†…ã«é€ƒã’å ´ã‚’ä½œã£ã¨ãã¨æ¥½ã‚„ã§",
            ],
            "evening": [
                "å¤•æ–¹ã¯äº¤é€šæ··ã¿ãŒã¡ã€ä½™è£•ã‚’æŒã£ã¦å‹•ã“",
                "ãƒ©ã‚¤ãƒˆã®åå°„ã§è¦‹ãˆã«ãã„ã€æ¨ªæ–­ã¯æ…é‡ã«ãª",
                "é›¨è„šå¼·ã¾ã£ãŸã‚‰è¨ˆç”»å¤‰æ›´ã‚‚ã‚¢ãƒªã‚„",
            ],
            "night": [
                "å¤œã¯è¦–ç•Œã•ã‚‰ã«æ‚ªã„ã€å‚˜ï¼‹åå°„æã§å®‰å…¨ã«",
                "å¯„ã‚Šé“ã›ãšå¸°å®…å„ªå…ˆã‚„ãª",
                "æ¿¡ã‚ŒãŸé´ã¯ç¿Œæœã«éŸ¿ãã§ã€å¸°ã£ãŸã‚‰ä¹¾ç‡¥ã‚„",
            ],
        },
        "warm": {
            "morning": [
                "æš–ã‹ã„é›¨ã§è’¸ã—æ°—å‘³ã€é€šæ°—ã®ãˆãˆæœãŒæ¥½ã‚„",
                "å‚˜ï¼‹ã‚¿ã‚ªãƒ«ã§å¿«é©åº¦ã‚­ãƒ¼ãƒ—ã—ã‚ˆ",
                "ãƒ ãƒ¬å¯¾ç­–ã§é€Ÿä¹¾ç´ æãŒãˆãˆã§",
            ],
            "noon": [
                "é›¨ã§ã‚‚æ°—æ¸©ã¯é«˜ã‚ã€ã“ã¾ã‚ã«æ°´åˆ†ã‚‚å¿˜ã‚Œãšã«",
                "å±‹å†…ã¨å±‹å¤–ã®å‡ºå…¥ã‚Šã§ãƒ ãƒ¯ãƒƒã¨ã™ã‚‹ã€ä½“èª¿ã«æ°—ãƒã¤ã‘ã¦",
                "è·ç‰©ã¯æ’¥æ°´ã ã¨å®‰å¿ƒã‚„",
            ],
            "evening": [
                "å¤•æ–¹ã¯é›¨è¶³ã«æ³¨æ„ã€å¼·ã¾ã£ãŸã‚‰äºˆå®šè¦‹ç›´ã—ã‚‚",
                "æ¹¿æ°—ã§ä½“åŠ›å¥ªã‚ã‚Œã‚‹ã€ç„¡ç†ã›ã‚“ã¨å¸°ã‚",
                "è¶³å…ƒã®ã™ã¹ã‚Šã¨è»Šã®æ°´ã¯ã­è¦æ³¨æ„ã‚„",
            ],
            "night": [
                "å¤œã®é›¨ã¯é™ã‹ã‚„ã‘ã©æ²¹æ–­ç¦ç‰©ã€è¦–ç•Œæ‚ªã„ã§",
                "å¸°ã‚Šã¯å‚˜ãã£ã¡ã‚Šå·®ã—ã¦ãª",
                "æ¿¡ã‚ŒãŸã‚‰ä½“å†·ãˆã‚‹ã€å¸°å®…å¾Œã¯æ¸©ã‹ã„é£²ã¿ã‚‚ã‚“ã§å›å¾©ã‚„",
            ],
        },
        "hot": {
            "morning": [
                "æš‘ã„ï¼‹é›¨ï¼ãƒ ã‚·ãƒ ã‚·ã‚„ã€æ±—ï¼†é›¨å¯¾ç­–ãƒ€ãƒ–ãƒ«ã§ã„ã“",
                "ãƒ¬ã‚¤ãƒ³ã‚¦ã‚§ã‚¢ã¯é€šæ°—æ€§é‡è¦–ã§ãª",
                "æ—¥å·®ã—å¼±ã„åˆ†ãƒã‚·ã‚„ã‘ã©è’¸ã™ã§ã€ç„¡ç†ã¯ç¦ç‰©",
            ],
            "noon": [
                "è’¸ã—æš‘ã„é›¨ã€ä¼‘æ†©æŒŸã‚“ã§ä½“åŠ›æ¸©å­˜ã‚„",
                "æ±—å†·ãˆã—ã‚„ã™ã„ã€ã‚¿ã‚ªãƒ«ã¨æ›¿ãˆã‚·ãƒ£ãƒ„ã‚ã‚‹ã¨æœ€é«˜",
                "åˆé–“ã®å°é›¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’æ´»ç”¨ã—ã‚ˆ",
            ],
            "evening": [
                "å¤•æ–¹ã‚‚è’¸ã—è’¸ã—ã€å¸°ã‚Šã¯ã‚†ã£ãã‚Šãƒšãƒ¼ã‚¹ã§ãª",
                "è·¯é¢ã®æ°´ãŸã¾ã‚Šè¦æ³¨æ„ã‚„ã€é´é¸ã³å¤§äº‹ã‚„ã§",
                "æ¹¿æ°—ã§ç–²ã‚Œå‡ºã‚„ã™ã„ã€æ—©ã‚ã®æ’¤åã‚ã‚Šã‚„",
            ],
            "night": [
                "å¤œã®è’¸ã—é›¨ã€å¯ã‚‹å‰ã¯å®¤æ¸©ã¨æ¹¿åº¦ã®èª¿æ•´ã—ã‚ˆ",
                "å¸°å®…å¾Œã¯ã‚·ãƒ£ãƒ¯ãƒ¼ã§ãƒªã‚»ãƒƒãƒˆã™ã‚‹ã¨æ¥½ã‚„",
                "å‚˜ã¯å¿˜ã‚Œãšä¹¾ã‹ã—ã¦ãªã€æ˜æ—¥ã‚‚ä½¿ãˆã‚‹ã‚ˆã†ã«",
            ],
        },
    },
    "snow": {
        "cold": {
            "morning": [
                "é›ªã§è·¯é¢ãƒ„ãƒ«ãƒ„ãƒ«ã€æ­©å¹…å°ã•ã‚ã§ã„ã“",
                "å†·ãŸã„æœã‚„ã€æ‰‹è¢‹ï¼†åšæ‰‹ã®é´ä¸‹ã§æ­¦è£…ã‚„",
                "è»¢å€’æ³¨æ„ã€æ™‚é–“ã«ã¯ä½™è£•æŒã£ã¦ãª",
            ],
            "noon": [
                "æ˜¼ã‚‚å†·ãˆãŸé›ªç©ºã€å±‹å¤–ã¯çŸ­æ™‚é–“ã§æ¸ˆã¾ã›ã‚ˆ",
                "æº¶ã‘ã‹ã‘é›ªãŒæ»‘ã‚‹ã€è¶³å…ƒã‚ˆã†è¦‹ã¦ãª",
                "ä½“æ¸©å¥ªã‚ã‚Œã‚„ã™ã„ã€æ¸©ã‹ã„é£²ã¿ã‚‚ã‚“ä¼‘æ†©å…¥ã‚Œã‚ˆ",
            ],
            "evening": [
                "å¤•æ–¹ã®å‡çµã«æ³¨æ„ã‚„ã€æ—©ã‚ã®å¸°å®…ãŒå‰",
                "æ—¥æ²¡ã§ä¸€æ®µã¨å±é™ºã€éšæ®µãƒ»æ¨ªæ–­ç‰¹ã«æ…é‡ã«",
                "é›ªã‹ãå¾Œã¯å†·ãˆã‚‹ã§ã€ã—ã£ã‹ã‚Šé˜²å¯’ãª",
            ],
            "night": [
                "å¤œã¯å‡ã¿ã‚‹å¯’ã•ã€å¤–ã¯æœ€å°é™ã§ã„ã“",
                "è¦–ç•ŒãŒæ‚ªã„é›ªå¤œã‚„ã€åå°„æã‚ã‚‹ã¨å®‰å¿ƒã‚„ã§",
                "å¸°å®…ã—ãŸã‚‰æ¸©ã‚‚ã£ã¦èº«ä½“ã„ãŸã‚ã‚",
            ],
        },
        "cool": {
            "morning": [
                "å°é›ªã¾ã˜ã‚Šã§ã²ã‚“ã‚„ã‚Šã€è¶³å…ƒã ã‘ã¯æ°—ãƒã¤ã‘ã¦",
                "è·¯é¢æ¿¡ã‚Œã¦å†·ãŸã„ã€æ»‘ã‚‰ã‚“ã‚ˆã†ã«ã­",
                "æ‰‹å…ˆå†·ãˆã‚„ã™ã„ã€ãƒã‚±ãƒƒãƒˆã«ã‚«ã‚¤ãƒ­å¿ã°ã›ã¨ã“",
            ],
            "noon": [
                "æ˜¼ã¯å°ä¼‘æ­¢ã®é›ªã€ç”¨äº‹ã¯ã¾ã¨ã‚ã¦ç‰‡ä»˜ã‘ã‚ˆ",
                "è¦–ç•ŒãŒç™½ã£ã½ã„ã€æ¨ªæ–­ã¯æ…é‡ã«",
                "æ¿¡ã‚ŒãŸé´ã¯å†·ãˆã‚‹ã§ã€æ›¿ãˆé´ä¸‹ã‚ã‚‹ã¨å®‰å¿ƒ",
            ],
            "evening": [
                "å¤•æ–¹ã¯å‡çµã®æº–å‚™æ®µéšã€å¯„ã‚Šé“æ§ãˆã‚ã§",
                "æ°—æ¸©ä¸‹ãŒã‚‹ã¨æ»‘ã‚‹ã€å¸°å®…æ™‚é–“ã¯ä½™è£•æŒã£ã¦",
                "æ‰‹è¢‹ã¨è€³å½“ã¦ã‚ã‚‹ã¨åŠ©ã‹ã‚‹ã§",
            ],
            "night": [
                "å¤œã¯å†å‡çµãŒæ€–ã„ã€æœ€çŸ­ãƒ«ãƒ¼ãƒˆã§å¸°ã‚",
                "é™ã‹ãªé›ªå¤œã‚„ã‘ã©è¶³å…ƒã¯æ²¹æ–­ã›ã‚“ã¨ã„ã¦",
                "é“è·¯ã®ç«¯ãŒå‡ã‚Šã‚„ã™ã„ã€è¸ã¾ã‚“ã‚ˆã†ã«ãª",
            ],
        },
        "warm": {
            "morning": [
                "ã¿ãã‚Œæ°—å‘³ã§ãƒ™ãƒãƒ£ã¤ãã€æ’¥æ°´ã®é´ãŒå®‰å¿ƒã‚„",
                "è§£ã‘ã‹ã‘ã§æ»‘ã‚‹ã§ã€æ­©å¹…ã¯å°ã•ã‚ã«",
                "æ¿¡ã‚Œå†·ãˆã—ã‚„ã™ã„ã€ä½“æ¸©ç®¡ç†ãª",
            ],
            "noon": [
                "æ˜¼ã¯è§£ã‘ã¦è¶³å…ƒã‚°ãƒãƒ£ã€ãƒ«ãƒ¼ãƒˆé¸ã³å¤§äº‹ã‚„ã§",
                "æ°´ã¯ã­æ³¨æ„ã€è£¾ãŒæ±šã‚Œã‚„ã™ã„ã§",
                "ç”¨äº‹ã¯çŸ­æ™‚é–“ã§ã‚µã‚µãƒƒã¨æ¸ˆã¾ã›ã‚ˆ",
            ],
            "evening": [
                "å¤•æ–¹ã«ã¾ãŸå†·ãˆæˆ»ã‚‹ã€è§£ã‘æ°´ãŒå‡ã‚‹å‰ã«å¸°ã‚",
                "æ¿¡ã‚ŒãŸé´ã¯å†·ãˆã‚‹ã§ã€äºˆå‚™æŒã¦ãŸã‚‰ãƒ™ã‚¹ãƒˆ",
                "è¦–ç•Œæ‚ªã„ã¨ã“ã¯ç„¡ç†ã›ã‚“ã“ã¨ã‚„",
            ],
            "night": [
                "å¤œã¯ã¿ãã‚Œã‚‚å‡ã‚‹ã§ã€å¤–å‡ºã¯ã»ã©ã»ã©ã«",
                "å¸°ã£ãŸã‚‰é´ã¨ã‚³ãƒ¼ãƒˆã‚’ã—ã£ã‹ã‚Šä¹¾ã‹ã",
                "å†·ãˆè¾¼ã¿ã«å‚™ãˆã¦æ¸©ã‹ã„ã‚‚ã®ã§ä½“åŠ›å›å¾©ã‚„",
            ],
        },
        "hot": {
            "morning": ["çã—ã„ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã‚„ã€è¶³å…ƒæœ€å„ªå…ˆã§ãª"]*3,
            "noon": ["ç„¡ç†ã›ã‚“ã§ã€å®‰å…¨ç¬¬ä¸€ã‚„"]*3,
            "evening": ["å¸°ã‚Šã¯æ—©ã‚ã«å‹•ã“"]*3,
            "night": ["å¤–ã¯å¿…è¦æœ€ä½é™ã§ãª"]*3,
        },
    },
    "thunder": {
        "cold": {
            "morning": [
                "é›·ã®å¯èƒ½æ€§ï¼‹å†·ãˆè¾¼ã¿ã€å¤–ã¯æœ€å°é™ã§ã„ã“",
                "å¯’ã•ã¨é›·ã¯ãƒ€ãƒ–ãƒ«ã§ã‚­ãƒ„ã„ã€å»ºç‰©ã®ä¸­ã§å¾…æ©ŸãŒå‰",
                "éŸ³ãŒã—ãŸã‚‰è¿‘ãã®å±‹å†…ã¸ã€ç„¡ç†ã¯ç¦ç‰©ã‚„",
            ],
            "noon": [
                "é›·æ³¨æ„ã€ç”¨äº‹ã¯å±‹å†…ä¸­å¿ƒã§çµ„ã¿ç›´ã",
                "ç¨²å…‰è¦‹ãˆãŸã‚‰å³é€€é¿ã€é•·å±…ã¯ã›ã‚“ã“ã¨ã‚„",
                "é‡‘å±è£½ã®é•·ã„ç‰©ã¯æŒã¡æ­©ã‹ã‚“ã»ã†ãŒå®‰å¿ƒã‚„ã§",
            ],
            "evening": [
                "å¤•æ–¹ã¯æš—ã•ã‚‚ç›¸ã¾ã£ã¦å±é™ºåº¦â†‘ã€æ—©ã‚æ’¤åã‚„",
                "é›·é³´è¿‘ã„ãªã‚‰å±‹å¤–æ´»å‹•ã¯ä¸­æ­¢ã‚„ã§",
                "å‚˜ã‚ˆã‚Šå»ºç‰©ã€èº«ã‚’å®ˆã‚‹ã‚“ãŒå…ˆã‚„",
            ],
            "night": [
                "å¤œã®é›·ã¯è¦–ç•Œæœ€æ‚ªã€å¤–å‡ºã¯æ§ãˆã‚ã«",
                "éŸ³ãŒç¶šããªã‚‰çª“ã‹ã‚‰é›¢ã‚Œã¦éã”ã",
                "åœé›»å¯¾ç­–ã§ãƒ©ã‚¤ãƒˆã®å ´æ‰€ã‚‚ç¢ºèªã—ã¨ã“",
            ],
        },
        "cool": {
            "morning": [
                "é›·ã®æ°—é…ã‚„ã€å¤–ã«å‡ºã‚‹ã¨ãã¯ç©ºãƒã‚§ãƒƒã‚¯ãª",
                "é›¨é¢¨å¼·ã¾ã‚‹å‰ã«è¦ä»¶æ¸ˆã¾ã›ã¨ã“",
                "ç„¡ç†ã«å¤–ã§ã®ä½œæ¥­ã¯ã›ã‚“ã»ã†ãŒãˆãˆã§",
            ],
            "noon": [
                "é›·æ³¨æ„ã€å±‹å†…ãƒ¡ã‚¤ãƒ³ã«åˆ‡ã‚Šæ›¿ãˆã‚ˆ",
                "ç¨²å…‰è¦‹ãˆãŸã‚‰å³æ’¤åã€èº«ã®å®‰å…¨å„ªå…ˆã‚„",
                "ç§»å‹•ã¯çŸ­è·é›¢ã§ã€é•·å±…ã¯é¿ã‘ã‚ˆ",
            ],
            "evening": [
                "å¤•æ–¹ã¯å±é™ºåº¦ä¸ŠãŒã‚‹ã€å»ºç‰©ã®è¿‘ãã§è¡Œå‹•ã‚„",
                "ã‚´ãƒ­ã‚´ãƒ­èã“ãˆãŸã‚‰äºˆå®šå¤‰æ›´ã‚„ã§",
                "å¸°ã‚Šé“ã¯å¯„ã‚Šé“ã›ã‚“ã¨ä¸€ç›´ç·šã§ãª",
            ],
            "night": [
                "å¤œã¯è¦–ç•Œæ‚ªã„ï¼‹é›·ã€å¤–ã¯æœ€å°é™ã«ã—ã‚ˆ",
                "å®‰å…¨ç¬¬ä¸€ã€çª“ã¨é›»æºå‘¨ã‚Šã‚‚æ³¨æ„ã‚„",
                "ç©ºãŒè’ã‚Œã¨ã‚‹æ—¥ã¯æ—©ã‚ã«ä¼‘ã‚€ãŒå‹ã¡ã‚„",
            ],
        },
        "warm": {
            "morning": [
                "æš–ã‹ã„ã‘ã©é›·ã¯å±é™ºã€å±‹å¤–ã¯æ§ãˆã‚ã«",
                "æœã®ã†ã¡ã«å®¤å†…ã§ã§ãã‚‹ã“ã¨é€²ã‚ã‚ˆ",
                "å‚˜ã‚ˆã‚Šã¾ãšé¿é›£å ´æ‰€ã€æ„è­˜ã—ã¨ã“",
            ],
            "noon": [
                "é›·é³´ã£ãŸã‚‰å±‹å†…é€€é¿ã€ç”¨äº‹ã¯ä¸€æ™‚ä¸­æ–­ã‚„ã§",
                "é›²ã®å‹•ãé€Ÿã„ã€ç©ºã®è‰²ãƒã‚§ãƒƒã‚¯ãª",
                "é‡‘å±ã‚„é«˜ã„å ´æ‰€ã¯é¿ã‘ã‚‹ã‚“ã‚„ã§",
            ],
            "evening": [
                "å¤•æ–¹ã¯é›·é›¨ã®ä¸€ç™ºæ¥ã‚„ã™ã„ã€æ™‚é–“ãšã‚‰ã™ã®ã‚‚ã‚¢ãƒª",
                "æš—ããªã‚‹å‰ã«ç§»å‹•ã‚’çµ‚ã‚ã‚‰ã›ã‚ˆ",
                "å®‰å…¨ãªãƒ«ãƒ¼ãƒˆã‚’å„ªå…ˆã—ã¦å¸°ã‚",
            ],
            "night": [
                "å¤œã®é›·ã¯ã»ã‚“ã¾å±ãªã„ã€å¤–å‡ºã¯å¿…è¦æœ€å°é™ã§",
                "å…‰ã£ãŸã‚‰æ•°ãˆã‚‹é–“ã‚‚ãªãã‚´ãƒ­ãƒƒã¨æ¥ã‚‹è·é›¢ã‹ã‚‚ã€å±‹å†…ã¸",
                "å¿µã®ãŸã‚æ‡ä¸­é›»ç¯ã‚‚ç”¨æ„ã—ã¨ã“",
            ],
        },
        "hot": {
            "morning": [
                "æš‘ãã¦ã‚‚é›·ã¯å±é™ºã€å¤–ã‚ˆã‚Šå±‹å†…å„ªå…ˆã‚„",
                "æ°´åˆ†ã¯å±‹å†…ã§å–ã‚Šã¤ã¤æ§˜å­è¦‹ã—ã‚ˆ",
                "ç©ºãŒé»’ã‹ã£ãŸã‚‰äºˆå®šå¤‰æ›´ã‚„ã§",
            ],
            "noon": [
                "é›·é›¨æ³¨æ„ã€ãƒ¢ãƒ¼ãƒ«ã‚„é§…ãƒ“ãƒ«ã«é€ƒã’å ´ä½œã£ã¨ã“",
                "ç¨²å…‰è¦‹ãˆãŸã‚‰å¤–å‡ºä¸­æ–­ï¼",
                "æš‘ã•ã‚ˆã‚Šã¾ãšå®‰å…¨ç¬¬ä¸€ã‚„",
            ],
            "evening": [
                "å¤•æ–¹ã®å‰ç·šé€šéã¯è’ã‚Œã‚„ã™ã„ã€æ—©å¸°ã‚Šæ¨å¥¨ã‚„",
                "ç„¡ç†ã›ãšäºˆå®šã¯å¾Œæ—¥ã«å›ã",
                "å¯„ã‚Šé“ã¯ã‚„ã‚ã¦ä¸€ç›´ç·šã§å¸°å®…ã‚„",
            ],
            "night": [
                "å¤œé–“ã®é›·ã¯ãƒªã‚¹ã‚¯é«˜ã‚ã€å®¶ã§å¤§äººã—ãã—ã‚ˆ",
                "åœé›»ã®å‚™ãˆã ã‘ã—ã¦ã€æ—©ã‚ã«ä¼‘ã‚€ã®ãŒå‰ã‚„",
                "çª“ã¨ãƒ™ãƒ©ãƒ³ãƒ€ã¯ç· ã‚ã¨ã“ãª",
            ],
        },
    },
}

# ---------- æ–¹è¨€ã‚¹ã‚­ãƒ³ ----------
DIALECT_PACKS = {
    "kansai":   {"intense":["ã‚ã£ã¡ã‚ƒ","ã‚ˆã†ã•ã‚“","ã ã„ã¶"], "end":["ã‚„","ã§","ã‚„ã§","ã‚„ãª","ã‚„ã‚"]},
    # â˜…æ±äº¬ã¯ã‚„ã‚ã‚‰ã‹èªå°¾ã‚’åšã‚ã«
    "tokyo":    {"intense":["ã™ã”ã","ã‹ãªã‚Š","ã‘ã£ã“ã†"],   "end":["ã ã‚ˆ","ã ã­","ã ã‚ˆã­","ã‹ãª","ã‹ã‚‚ã­","ã ãªã‚","ã ã­ã‡"]},
    "nagoya":   {"intense":["ã§ã‚‰","ã©ãˆã‚Šã‚ƒã‚","ã‚ˆã†ã‘"],   "end":["ã ã§","ã ãŒã­","ã ã‚"]},
    "hokkaido": {"intense":["ãªã¾ã‚‰","ã‚ã‚„","ãŸã£ã‘"],       "end":["ã ã¹ã•","ã ã£ã—ã‚‡","ã§ãªã„ã‹ã„"]},
    "tohoku":   {"intense":["ã„ã£ãºã‡","ã ã„ã¶","ã‚ã‚“ã¤ã‹"],  "end":["ã ã¹","ã ã£ã¡ã‚ƒ","ã ãª"]},
    "hiroshima":{"intense":["ã¶ã¡","ãŸã„ãã„ãã‚‰ã„","ãã‚‡ã†ã•ã‚“"], "end":["ã˜ã‚ƒã‘ã‡","ã—ã‚“ã•ã„","ãªã‚“ã‚ˆ"]},
    "hakata":   {"intense":["ã°ã‚Š","ã¨ã£ã¨ãƒ¼ã¨","ã‚ˆã†ã‘"],     "end":["ã£ã¡ã‚ƒ","ã°ã„","ãŸã„"]},
    "okinawa":  {"intense":["ã¨ã¦ã‚‚","ã‹ãªã‚Š","ã¡ã‚…ã‚‰ã„"],     "end":["ã•ãƒ¼","ã­ãƒ¼","ã‚ˆãƒ¼"]},
}

def pick_dialect_key(place: dict) -> str:
    pref = (place.get("admin1") or "").strip()
    if pref in ["å¤§é˜ªåºœ","äº¬éƒ½åºœ","å…µåº«çœŒ","æ»‹è³€çœŒ","å¥ˆè‰¯çœŒ","å’Œæ­Œå±±çœŒ"]:
        return "kansai"
    if pref in ["æ±äº¬éƒ½","ç¥å¥ˆå·çœŒ","åƒè‘‰çœŒ","åŸ¼ç‰çœŒ"]:
        return "tokyo"
    if pref in ["æ„›çŸ¥çœŒ","å²é˜œçœŒ","ä¸‰é‡çœŒ"]:
        return "nagoya"
    if pref == "åŒ—æµ·é“":
        return "hokkaido"
    if pref in ["é’æ£®çœŒ","å²©æ‰‹çœŒ","å®®åŸçœŒ","ç§‹ç”°çœŒ","å±±å½¢çœŒ","ç¦å³¶çœŒ"]:
        return "tohoku"
    if pref in ["åºƒå³¶çœŒ","å²¡å±±çœŒ","å±±å£çœŒ","é³¥å–çœŒ","å³¶æ ¹çœŒ"]:
        return "hiroshima"
    if pref in ["ç¦å²¡çœŒ","ä½è³€çœŒ","é•·å´çœŒ","ç†Šæœ¬çœŒ","å¤§åˆ†çœŒ","å®®å´çœŒ","é¹¿å…å³¶çœŒ"]:
        return "hakata"
    if pref == "æ²–ç¸„çœŒ":
        return "okinawa"
    # æœªçŸ¥ã¯â€œä¸­ç«‹â€ã®æ±äº¬
    return "tokyo"

# ---------- é–¢è¥¿â†’æ¨™æº– æ­£è¦åŒ– â†’ æ–¹è¨€ã‚¹ã‚­ãƒ³é©ç”¨ + æŸ”ã‚‰ã‹ç ‚ç³– ----------
KANSAI_TO_NEUTRAL = [
    (r"ç„¡ç†ã›ã‚“ã¨", "ç„¡ç†ã›ãš"),
    (r"æ°—ãƒã¤ã‘", "æ°—ã‚’ã¤ã‘"),
    (r"ã—ã‚ˆãª", "ã—ã‚ˆã†ã­"),
    (r"ã—ã‚ˆã‹", "ã—ã‚ˆã†ã‹"),
    (r"ã—ã‚ˆ", "ã—ã‚ˆã†"),
    (r"ã‚„ã‚", "ã ã‚ã†"),
    (r"ã›ã‚“ã¨ã“", "ã—ãªã„ã§ãŠã“ã†"),
    (r"ã›ã‚“ã¨", "ã—ãªã„ã¨"),
    (r"å¸°ã‚(?!ã†)", "å¸°ã‚ã†"),
]

SOFT_TAILS = ["ã‚ˆã­", "ã‹ãª", "ã­ã€œ", "ãªã‚", "ã‹ã‚‚", "ã‹ã‚‚ã­", "ã‚ˆã€œ", "ã­ã‡"]

def neutralize(text: str) -> str:
    def drop_kansai_tail(s: str) -> str:
        return re.sub(r"(ã‚„ã§|ã‚„ãª|ã‚„ã‚|ã‚„|ã§)$", "", s)
    sents = [t.strip() for t in re.split(r"ã€‚+", text) if t.strip()]
    out = []
    for s in sents:
        s = drop_kansai_tail(s)
        for pat, rep in KANSAI_TO_NEUTRAL:
            s = re.sub(pat, rep)
        out.append(s)
    return "ã€‚".join(out) + "ã€‚"

def add_soft_tail(text: str, prob=0.6):
    if random.random() >= prob:
        return text
    sents = [s.strip() for s in re.split(r"ã€‚+", text) if s.strip()]
    if not sents:
        return text
    i = random.randrange(len(sents))
    # æ—¢ã«çµ‚åŠ©è©ãŒã‚ã‚Œã°è¶³ã•ãªã„
    if re.search(r"(ã‚ˆ|ã­|ãª|ã‹ã‚‚|ãŸã„|ã°ã„|ã˜ã‚ƒã‘ã‡|ã•ãƒ¼|ã‚ˆãƒ¼|ã­ãƒ¼)$", sents[i]):
        return "ã€‚".join(sents) + "ã€‚"
    sents[i] = sents[i] + random.choice(SOFT_TAILS)
    return "ã€‚".join(sents) + "ã€‚"

def dialectize(text: str, key: str) -> str:
    # 1) ä¸­ç«‹åŒ–
    text = neutralize(text)
    # 2) ã‚¹ã‚­ãƒ³é©ç”¨
    pack = DIALECT_PACKS.get(key, DIALECT_PACKS["tokyo"])
    for base in ["ã‚ã£ã¡ã‚ƒ","ã™ã”ã","ã‹ãªã‚Š","ã‘ã£ã“ã†","ã ã„ã¶"]:
        text = re.sub(re.escape(base), random.choice(pack["intense"]), text)

    # æœ«å°¾ä»˜ä¸ã¯æ–­å®šæ–‡ã ã‘ï¼ˆä¾é ¼ãƒ»å‹§èª˜ã«ã¯ä»˜ã‘ãªã„ï¼‰
    def tweak_sent(s):
        s = s.strip()
        if not s:
            return s
        if re.search(r"(ã—ã‚ˆã†|ã‚ˆã†|ã‚ã†|ã¦ã­|ãã ã•ã„|ã—ã¦ã­|ã—ã¦|ã—ã¾ãŠã†|ã—ãªãã‚ƒ|ã—ã¾ã—ã‚‡ã†|ãã ã•ã„ã­|ã—ã‚ˆã†ã­|ã—ã¾ãŠã†ã­)$", s):
            return s
        if re.search(r"[!?ï¼ï¼Ÿ]$", s):
            return s
        end = random.choice(pack["end"])
        s = re.sub(r"(ã§ã™|ã |ã­|ã‚ˆ|ã‚)$", "", s)
        return s + end

    sentences = [tweak_sent(s) for s in re.split(r"ã€‚+", text) if s.strip()]
    out = "ã€‚".join(sentences) + "ã€‚"
    # 3) ã‚„ã‚ã‚‰ã‹ç ‚ç³–
    return add_soft_tail(out, prob=0.6)

# ---------- AA ----------
AA = ["|Ï‰ãƒ»)", "(/Ï‰ï¼¼)", "( Â´ â–½ ` )", "(ï¿£â–½ï¿£;)", "(ï½€ãƒ»Ï‰ãƒ»Â´)", "( Ë˜Ï‰Ë˜ )", "(ï½¡ï½¥Ï‰ï½¥ï½¡)", "(ï¼›ãƒ»âˆ€ãƒ»)", "(ãƒ»âˆ€ãƒ»)", "(>_<)"]
def maybe_aa(p=0.85):  # â˜…é »åº¦UP
    return (" " + random.choice(AA)) if random.random() < p else ""

# ---------- å®‰å…¨ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ‹¾ã†ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰ ----------
def pick_safe_comment(w: str, t: str, d: str) -> str:
    weather_order = {
        "thunder": ["thunder","rain","cloudy","clear"],
        "snow":    ["snow","cloudy","clear"],
        "rain":    ["rain","cloudy","clear"],
        "cloudy":  ["cloudy","clear"],
        "clear":   ["clear","cloudy"],
    }
    temp_keys  = ["cold","cool","warm","hot"]
    time_keys  = ["morning","noon","evening","night"]

    for wkey in weather_order.get(w, ["cloudy","clear"]):
        wdict = comments.get(wkey)
        if not wdict:
            continue
        for tkey in [t] + [k for k in temp_keys if k != t]:
            tdict = wdict.get(tkey)
            if not tdict:
                continue
            for dkey in [d] + [k for k in time_keys if k != d]:
                lst = tdict.get(dkey)
                if lst:
                    return random.choice(lst)
    return "ä»Šæ—¥ã¯ã‚ã‚Šã¨ç„¡é›£ãªã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã€‚å®‰å…¨ç¬¬ä¸€ã§ã„ã“ã†ã€‚"

# ---------- ã‚³ãƒ¡ãƒ³ãƒˆç”Ÿæˆï¼ˆå®‰å…¨åŒ–ï¼‰ ----------
def build_comment_base(rows: list[dict]) -> str:
    try:
        w = categorize_weather(rows)
        t = categorize_temp(rows)
        d = categorize_time(rows)
        base = pick_safe_comment(w, t, d)
    except Exception as e:
        print(f"[WARN] comment build failed: {e}")
        max_temp = max(r['temp'] for r in rows)
        thunder  = any(r['weathercode'] in (95,96,99) for r in rows)
        rainlike = any(r['weathercode'] in (51,53,55,61,63,65,66,67,80,81,82) for r in rows)
        if thunder:
            base = "é›·ã®å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚å¤–å‡ºã¯æ°—ã‚’ã¤ã‘ã¦ã­"
        elif rainlike:
            base = "é›¨ãŒæ¥ãã†ã€‚å‚˜ãŒã‚ã‚‹ã¨å®‰å¿ƒã ã‚ˆ"
        elif max_temp >= 28:
            base = "æš‘ã„ã‹ã‚‰æ°´åˆ†ã—ã£ã‹ã‚Šã­"
        elif max_temp < 10:
            base = "å†·ãˆã‚‹ã‹ã‚‰æš–ã‹ãã—ã¦ã„ã“ã†"
        else:
            base = "ä»Šæ—¥ã¯éã”ã—ã‚„ã™ãã†ã ã‚ˆ"

    max_wind = max(r.get("wind", 0.0) for r in rows)
    if max_wind >= 15:
        base += " é¢¨ãŒå¼·ã™ãã‚‹ã‹ã‚‰ã€å¸½å­ã‚„å‚˜ã¯è¦æ³¨æ„ã€‚"
    elif max_wind >= 10:
        base += " é¢¨ãŒå¼·ã‚ã ã‹ã‚‰ã€æ´—æ¿¯ç‰©ã¨è‡ªè»¢è»Šã¯æ°—ã‚’ã¤ã‘ã¦ã­ã€‚"
    return base

# ---------- è¡¨ç¤º ----------
def build_embed(place: dict, rows: list[dict]) -> discord.Embed:
    loc = place['name']; admin = place.get('admin1') or ''; country = place.get('country') or ''
    title = f"{loc}ï¼ˆ{admin + 'ãƒ»' if admin else ''}{country}ï¼‰".strip("ï¼ˆï¼‰")
    embed = discord.Embed(title=f"ç›´è¿‘3æ™‚é–“ã®å¤©æ°— | {title}", color=0x4C7CF3)
    lines=[]
    for r in rows:
        t=r['time']; emoji=pick_emoji(r['weathercode'])
        wind = r.get("wind", 0.0)
        lines.append(
            f"**{t.strftime('%H:%M')}** {emoji}  æ°—æ¸© **{r['temp']:.1f}Â°C**  "
            f"é™æ°´ç¢ºç‡ **{r['pop']}%**  é™æ°´é‡ **{r['precip']:.1f}mm**  é¢¨é€Ÿ **{wind:.1f}m/s**"
        )
    embed.description="\n".join(lines)
    ts=datetime.now(JST).strftime('%Y-%m-%d %H:%M')
    embed.set_footer(text=f"æ›´æ–°: {ts} JST â€¢ Powered by Open-Meteo")
    return embed

# ---------- Core ----------
async def get_next_3_hours(session: aiohttp.ClientSession, place_query: str):
    geo = await geocode(session, place_query)
    if not geo:
        return None, None, "å ´æ‰€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚åˆ¥ã®è¡¨è¨˜ã§ã‚‚ã†ä¸€åº¦è©¦ã—ã¦ã­ã€‚"
    data = await fetch_forecast(session, geo["latitude"], geo["longitude"], geo["timezone"])
    if not data or "hourly" not in data:
        return geo, None, "å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚"

    times = data["hourly"]["time"]
    temps = data["hourly"]["temperature_2m"]
    pops  = data["hourly"].get("precipitation_probability", [0]*len(times))
    precs = data["hourly"].get("precipitation", [0.0]*len(times))
    codes = data["hourly"].get("weathercode", [0]*len(times))
    winds = data["hourly"].get("windspeed_10m", [0.0]*len(times))

    now = datetime.now(JST)
    rows=[]
    for i, ts in enumerate(times):
        try:
            t = datetime.fromisoformat(ts.replace("Z", "+00:00")).astimezone(JST)
        except Exception:
            continue
        if t >= now and len(rows) < 3:
            rows.append({
                "time": t,
                "temp": float(temps[i]),
                "pop": int(pops[i]) if i < len(pops) and pops[i] is not None else 0,
                "precip": float(precs[i]) if i < len(precs) and precs[i] is not None else 0.0,
                "weathercode": int(codes[i]) if i < len(codes) and codes[i] is not None else 0,
                "wind": float(winds[i]) if i < len(winds) and winds[i] is not None else 0.0,
            })
        if len(rows) == 3:
            break
    if not rows:
        return geo, None, "ç›´è¿‘3æ™‚é–“ã®ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚"
    return geo, rows, None

# ---------- Message handling ----------
MENTION_PATTERN = re.compile(r"<@!?(\d+)>")

def extract_query_from_message(content: str, bot_id: int) -> str | None:
    m = MENTION_PATTERN.search(content)
    if not m: return None
    if int(m.group(1)) != bot_id: return None
    rest = MENTION_PATTERN.sub("", content, count=1).strip()
    return rest or None

@client.event
async def on_ready():
    print(f"Bot version: {BOT_VERSION}")
    print(f"Logged in as {client.user} (ID: {client.user.id})")
    print("------")

@client.event
async def on_message(message: discord.Message):
    if message.author.bot:
        return
    query = extract_query_from_message(message.content, client.user.id)
    if not query:
        return
    async with message.channel.typing():
        async with aiohttp.ClientSession() as session:
            place, rows, err = await get_next_3_hours(session, query)
            if err:
                dialect = pick_dialect_key(place or {"admin1": None})
                await message.reply(dialectize(err, dialect) + maybe_aa(), mention_author=False)
                return

            embed = build_embed(place, rows)
            try:
                base = build_comment_base(rows)
                dialect = pick_dialect_key(place)
                comment = dialectize(base, dialect)
                # æœ€ä½1å€‹ã¯AA
                if not re.search(r"\(|\||ï¼", comment):
                    comment += maybe_aa()
            except Exception as e:
                print(f"[WARN] dialectize failed: {e}")
                comment = base + maybe_aa()
            await message.reply(content=comment, embed=embed, mention_author=False)

@client.tree.command(name="weather", description="åœ°åãƒ»ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯åã‹ã‚‰ç›´è¿‘3æ™‚é–“ã®å¤©æ°—ã‚’è¡¨ç¤ºã—ã¾ã™")
@app_commands.describe(location="åœ°å/ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ï¼ˆä¾‹ï¼šå¤§é˜ª, USJ, æ±äº¬ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼ãƒ©ãƒ³ãƒ‰ï¼‰")
async def weather(interaction: discord.Interaction, location: str):
    await interaction.response.defer(thinking=True)
    async with aiohttp.ClientSession() as session:
        place, rows, err = await get_next_3_hours(session, location)
        if err:
            dialect = pick_dialect_key(place or {"admin1": None})
            await interaction.followup.send(dialectize(err, dialect) + maybe_aa(), ephemeral=True)
            return

        embed = build_embed(place, rows)
        try:
            base = build_comment_base(rows)
            dialect = pick_dialect_key(place)
            comment = dialectize(base, dialect)
            if not re.search(r"\(|\||ï¼", comment):
                comment += maybe_aa()
        except Exception as e:
            print(f"[WARN] dialectize failed: {e}")
            comment = base + maybe_aa()
        await interaction.followup.send(content=comment, embed=embed)

def main():
    if not BOT_TOKEN:
        raise RuntimeError("ç’°å¢ƒå¤‰æ•° DISCORD_BOT_TOKEN ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚")
    client.run(BOT_TOKEN)

if __name__ == "__main__":
    main()
